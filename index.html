<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Landscaping Project Tracker</title>
    <!-- Load Tailwind CSS from CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load React and ReactDOM from CDNs -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Load Babel for JSX support in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Load Firebase libraries from CDNs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { 
            getAuth, 
            signInAnonymously,
            onAuthStateChanged,
            signOut,
            } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { 
            getFirestore, 
            doc, 
            onSnapshot, 
            setDoc, 
            updateDoc,
            collection,
            addDoc,
            } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // Global variables for Firebase services
        window.firebaseApp = initializeApp;
        window.firebaseAuth = getAuth;
        window.firebaseFirestore = getFirestore;
        window.signInAnonymously = signInAnonymously;
        window.onAuthStateChanged = onAuthStateChanged;
        window.signOut = signOut;
        window.doc = doc;
        window.onSnapshot = onSnapshot;
        window.setDoc = setDoc;
        window.updateDoc = updateDoc;
        window.collection = collection;
        window.addDoc = addDoc;
    </script>
    <style>
      body {
        font-family: 'Inter', sans-serif;
      }
    </style>
</head>
<body class="bg-gray-100">

    <div id="root"></div>

    <!-- The entire React component code -->
    <script type="text/babel">
        const { useState, useEffect } = React;
        const { firebaseApp, firebaseAuth, firebaseFirestore, signInAnonymously, onAuthStateChanged, signOut, doc, onSnapshot, setDoc, updateDoc, collection, addDoc } = window;

        // The App component from the previous code block
        const App = () => {
            // --- State Variables ---
            const [inputPassword, setInputPassword] = useState('');
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [loading, setLoading] = useState(true);
            const [projectData, setProjectData] = useState(null);
            const [notes, setNotes] = useState([]);
            const [noteInput, setNoteInput] = useState('');
            const [message, setMessage] = useState('');
            const [userId, setUserId] = useState('');
            const [paymentAmount, setPaymentAmount] = useState('');
            const [paymentDate, setPaymentDate] = useState('');
            const [payments, setPayments] = useState([]);
            const [unexpectedCostAmount, setUnexpectedCostAmount] = useState('');
            const [unexpectedCostNotes, setUnexpectedCostNotes] = useState('');
            const [provisionalSums, setProvisionalSums] = useState([]);
            const [primeCosts, setPrimeCosts] = useState([]);
            const [excludedItems, setExcludedItems] = useState([]);
            const [newExcludedItem, setNewExcludedItem] = useState('');

            // --- Firebase Initialization ---
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
            const correctPassword = '201186';

            // Initialize Firebase services
            const app = firebaseApp(firebaseConfig);
            const auth = firebaseAuth(app);
            const db = firebaseFirestore(app);

            // --- Helper function to format currency ---
            const formatCurrency = (amount) => {
                return new Intl.NumberFormat('en-AU', {
                    style: 'currency',
                    currency: 'AUD',
                    minimumFractionDigits: 2
                }).format(amount);
            };

            // --- Authentication and Data Fetching Effects ---
            useEffect(() => {
                const unsubscribeAuth = onAuthStateChanged(auth, async (currentUser) => {
                    if (currentUser) {
                        setUserId(currentUser.uid);
                    } else {
                        setUserId('');
                    }
                    setLoading(false);
                });

                return () => unsubscribeAuth();
            }, [auth]);

            useEffect(() => {
                if (!isAuthenticated || !userId) return;

                const projectDocRef = doc(db, 'artifacts', appId, 'users', userId, 'projectData', 'main');
                const paymentsRef = collection(db, 'artifacts', appId, 'users', userId, 'payments');

                const setupInitialData = async () => {
                    const initialData = {
                        totalCost: 226546.48,
                        currentSpend: 0,
                        stages: {
                            "Hardworks": false,
                            "Softworks": false,
                            "Variations": false,
                            "Final Completion": false,
                        },
                        notes: [],
                        unexpectedCosts: [],
                        provisionalSums: [
                            { description: "Electrical Works", estimated: 7500, actual: null, checked: false },
                            { description: "Plumbing Works", estimated: 4500, actual: null, checked: false },
                            { description: "Excavation and Site Preparation", estimated: 12000, actual: null, checked: false },
                            { description: "Fencing", estimated: 8000, actual: null, checked: false },
                            { description: "Tiling and Paving", estimated: 15000, actual: null, checked: false },
                            { description: "Lighting Fixtures", estimated: 2500, actual: null, checked: false },
                            { description: "Water Features", estimated: 5000, actual: null, checked: false },
                            { description: "Timber Decking", estimated: 9000, actual: null, checked: false },
                        ],
                        primeCosts: [
                            { description: "Retaining Wall", allowance: 10000, actual: null, checked: false },
                            { description: "Pool", allowance: 50000, actual: null, checked: false },
                            { description: "Pergola", allowance: 6000, actual: null, checked: false },
                            { description: "Outdoor Kitchen", allowance: 12000, actual: null, checked: false },
                            { description: "Irrigation System", allowance: 3000, actual: null, checked: false },
                            { description: "Garden Shed/Storage", allowance: 2500, actual: null, checked: false},
                            { description: "Patio Furniture/Outdoor Seating", allowance: 4000, actual: null, checked: false},
                        ],
                        excludedItems: [],
                    };
                    try {
                        await setDoc(projectDocRef, initialData, { merge: true });
                        console.log("Initial data set for new user.");
                    } catch (error) {
                        console.error("Error setting initial data: ", error);
                    }
                };

                const unsubscribeFirestore = onSnapshot(projectDocRef, (docSnap) => {
                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        setProjectData(data);
                        setNotes(data.notes || []);
                        setProvisionalSums(data.provisionalSums || []);
                        setPrimeCosts(data.primeCosts || []);
                        setExcludedItems(data.excludedItems || []);
                    } else {
                        console.log("No such document! Setting up initial data.");
                        setupInitialData();
                    }
                }, (error) => {
                    console.error("Error fetching Firestore data: ", error);
                    setMessage("Failed to load project data. Please try again.");
                });

                const unsubscribePayments = onSnapshot(paymentsRef, (snapshot) => {
                    const paymentsList = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    setPayments(paymentsList.sort((a, b) => new Date(a.date) - new Date(b.date)));
                }, (error) => {
                    console.error("Error fetching payments:", error);
                });

                return () => {
                    unsubscribeFirestore();
                    unsubscribePayments();
                };
            }, [isAuthenticated, userId, db, appId]);


            const handleLogin = async (e) => {
                e.preventDefault();
                if (inputPassword === correctPassword) {
                    try {
                        await signInAnonymously(auth);
                        setIsAuthenticated(true);
                        setMessage('Logged in successfully!');
                    } catch (error) {
                        setMessage(`Error logging in: ${error.message}`);
                    }
                } else {
                    setMessage('Incorrect password. Please try again.');
                }
            };

            const handleLogout = async () => {
                try {
                    await signOut(auth);
                    setIsAuthenticated(false);
                    setProjectData(null);
                    setNotes([]);
                    setMessage('Logged out successfully!');
                } catch (error) {
                    setMessage(`Error logging out: ${error.message}`);
                }
            };

            const handleStageChange = async (stage) => {
                if (!projectData || !userId) return;
                const newStages = { ...projectData.stages, [stage]: !projectData.stages[stage] };
                const projectDocRef = doc(db, 'artifacts', appId, 'users', userId, 'projectData', 'main');
                try {
                    await updateDoc(projectDocRef, { stages: newStages });
                } catch (error) {
                    console.error("Error updating stage:", error);
                    setMessage("Failed to update stage. Please check your connection.");
                }
            };
            
            const handleResetStages = async () => {
                if (!projectData || !userId) return;
                const resetStages = Object.keys(projectData.stages).reduce((acc, stage) => {
                    acc[stage] = false;
                    return acc;
                }, {});
                const projectDocRef = doc(db, 'artifacts', appId, 'users', userId, 'projectData', 'main');
                try {
                    await updateDoc(projectDocRef, { stages: resetStages });
                    setMessage("Project stages have been reset.");
                } catch (error) {
                    console.error("Error resetting stages:", error);
                    setMessage("Failed to reset stages. Please try again.");
                }
            };

            const handleAddNote = async (e) => {
                e.preventDefault();
                if (!noteInput || !userId || !projectData) return;

                const newNotes = [...projectData.notes, {
                    text: noteInput,
                    timestamp: new Date().toISOString(),
                }];

                const projectDocRef = doc(db, 'artifacts', appId, 'users', userId, 'projectData', 'main');
                try {
                    await updateDoc(projectDocRef, {
                        notes: newNotes,
                    });
                    setNoteInput('');
                } catch (error) {
                    console.error("Error adding note:", error);
                    setMessage("Failed to add note. Please try again.");
                }
            };
            
            const handleAddExcludedItem = async (e) => {
                e.preventDefault();
                if (!newExcludedItem || !userId || !projectData) return;
                
                const updatedItems = [...excludedItems, {
                    description: newExcludedItem,
                    checked: false,
                }];
                
                const projectDocRef = doc(db, 'artifacts', appId, 'users', userId, 'projectData', 'main');
                try {
                    await updateDoc(projectDocRef, { excludedItems: updatedItems });
                    setNewExcludedItem('');
                } catch (error) {
                    console.error("Error adding excluded item:", error);
                    setMessage("Failed to add excluded item. Please try again.");
                }
            };

            const handleAddPayment = async (e) => {
                e.preventDefault();
                if (!paymentAmount || !paymentDate || !userId || !projectData) return;

                const amount = parseFloat(paymentAmount);
                if (isNaN(amount)) {
                    setMessage("Please enter a valid amount.");
                    return;
                }

                const projectDocRef = doc(db, 'artifacts', appId, 'users', userId, 'projectData', 'main');
                const paymentsRef = collection(db, 'artifacts', appId, 'users', userId, 'payments');

                const newCurrentSpend = parseFloat((projectData.currentSpend + amount).toFixed(2));
                const newPayment = {
                    amount: amount,
                    date: paymentDate,
                    timestamp: new Date().toISOString(),
                };

                try {
                    await updateDoc(projectDocRef, {
                        currentSpend: newCurrentSpend,
                    });
                    await addDoc(paymentsRef, newPayment);
                    setPaymentAmount('');
                    setPaymentDate('');
                } catch (error) {
                    console.error("Error adding payment:", error);
                    setMessage("Failed to add payment. Please try again.");
                }
            };

            const handleAddUnexpectedCost = async (e) => {
                e.preventDefault();
                if (!unexpectedCostAmount || !userId || !projectData) return;
                const amount = parseFloat(unexpectedCostAmount);
                if (isNaN(amount)) {
                    setMessage("Please enter a valid amount for unexpected cost.");
                    return;
                }

                const newUnexpectedCosts = [...projectData.unexpectedCosts, {
                    amount: amount,
                    notes: unexpectedCostNotes,
                    date: new Date().toISOString(),
                }];
                
                const projectDocRef = doc(db, 'artifacts', appId, 'users', userId, 'projectData', 'main');
                try {
                    await updateDoc(projectDocRef, {
                        unexpectedCosts: newUnexpectedCosts,
                    });
                    setUnexpectedCostAmount('');
                    setUnexpectedCostNotes('');
                } catch (error) {
                    console.error("Error adding unexpected cost:", error);
                    setMessage("Failed to add unexpected cost. Please try again.");
                }
            };
            
            const handleProvisionalSumChange = async (index) => {
                if (!projectData || !userId) return;
                const updatedSums = [...provisionalSums];
                updatedSums[index].checked = !updatedSums[index].checked;
                const projectDocRef = doc(db, 'artifacts', appId, 'users', userId, 'projectData', 'main');
                try {
                    await updateDoc(projectDocRef, { provisionalSums: updatedSums });
                } catch (error) {
                    console.error("Error updating provisional sum:", error);
                    setMessage("Failed to update provisional sum. Please check your connection.");
                }
            };
            
            const handlePrimeCostChange = async (index) => {
                if (!projectData || !userId) return;
                const updatedCosts = [...primeCosts];
                updatedCosts[index].checked = !updatedCosts[index].checked;
                const projectDocRef = doc(db, 'artifacts', appId, 'users', userId, 'projectData', 'main');
                try {
                    await updateDoc(projectDocRef, { primeCosts: updatedCosts });
                } catch (error) {
                    console.error("Error updating prime cost:", error);
                    setMessage("Failed to update prime cost. Please check your connection.");
                }
            };
            
            const handleExcludedItemChange = async (index) => {
                const updatedItems = [...excludedItems];
                updatedItems[index].checked = !updatedItems[index].checked;
                const projectDocRef = doc(db, 'artifacts', appId, 'users', userId, 'projectData', 'main');
                try {
                    await updateDoc(projectDocRef, { excludedItems: updatedItems });
                } catch (error) {
                    console.error("Error updating excluded item:", error);
                }
            };
            
            const renderTimeline = () => {
                if (!projectData) return null;
                
                const timelineEvents = [
                    { name: "Week 1: Project Start", completed: true },
                    { name: "Week 2: Hardworks", completed: projectData.stages["Hardworks"] },
                    { name: "Week 4: Softworks", completed: projectData.stages["Softworks"] },
                    { name: "Week 5: Mid-project Check", completed: false }, 
                    { name: "Week 6: Variations", completed: projectData.stages["Variations"] },
                    { name: "Week 8: Final Completion", completed: projectData.stages["Final Completion"] },
                ];
                
                return (
                    <div className="flex justify-between items-center w-full overflow-x-auto p-4 space-x-4">
                        {timelineEvents.map((event, index) => (
                            <div key={index} className="flex flex-col items-center">
                                <div className={`w-10 h-10 rounded-full flex items-center justify-center text-white text-base font-bold ${event.completed ? 'bg-green-500' : 'bg-gray-400'}`}>
                                    {index + 1}
                                </div>
                                <p className="mt-2 text-center text-sm font-semibold whitespace-nowrap">{event.name}</p>
                            </div>
                        ))}
                    </div>
                );
            };

            if (loading) {
                return <div className="flex items-center justify-center min-h-screen bg-gray-100">Loading...</div>;
            }

            if (!isAuthenticated) {
                return (
                    <div className="min-h-screen bg-gray-100 flex items-center justify-center p-4 font-sans">
                        <div className="bg-white p-8 rounded-lg shadow-lg max-w-sm w-full">
                            <h2 className="text-2xl font-bold mb-4 text-center text-gray-800">
                                Enter Project Password
                            </h2>
                            <p className="text-center text-sm text-red-500 h-6">{message}</p>
                            <form onSubmit={handleLogin}>
                                <input
                                    type="password"
                                    value={inputPassword}
                                    onChange={(e) => setInputPassword(e.target.value)}
                                    placeholder="Numeric Password"
                                    className="w-full p-2 mb-4 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    required
                                />
                                <button
                                    type="submit"
                                    className="w-full bg-blue-500 text-white p-2 rounded-md font-semibold hover:bg-blue-600 transition-colors"
                                >
                                    Log In
                                </button>
                            </form>
                        </div>
                    </div>
                );
            }
            
            const totalUnexpectedCosts = projectData?.unexpectedCosts.reduce((sum, item) => sum + item.amount, 0) || 0;
            const provisionalSumOverrun = provisionalSums.reduce((sum, item) => sum + (item.actual - item.estimated > 0 ? item.actual - item.estimated : 0), 0);
            const primeCostOverrun = primeCosts.reduce((sum, item) => sum + (item.actual - item.allowance > 0 ? item.actual - item.allowance : 0), 0);
            
            const totalProvisionalSums = provisionalSums.reduce((sum, item) => sum + item.estimated, 0);
            const totalPrimeCosts = primeCosts.reduce((sum, item) => sum + item.allowance, 0);
            const totalPayments = payments.reduce((sum, payment) => sum + payment.amount, 0);
            
            const totalOverrun = totalUnexpectedCosts + provisionalSumOverrun + primeCostOverrun;
            const finalProjectedCost = (projectData?.totalCost || 0) + totalOverrun;
            const currentProgress = (totalPayments / (finalProjectedCost || 1)) * 100;

            return (
                <div className="min-h-screen bg-gray-100 p-4 font-sans text-gray-800">
                    <header className="bg-white p-6 rounded-lg shadow-md mb-4 flex flex-col md:flex-row justify-between items-center">
                        <h1 className="text-2xl font-bold text-blue-600">Landscaping Tracker</h1>
                        <div className="flex items-center space-x-4 mt-4 md:mt-0">
                            <p className="text-sm text-gray-600 hidden md:block">User ID: <span className="font-mono text-xs">{userId}</span></p>
                            <button
                                onClick={handleLogout}
                                className="bg-red-500 text-white text-sm px-4 py-2 rounded-md hover:bg-red-600 transition-colors"
                            >
                                Log Out
                            </button>
                        </div>
                    </header>

                    <main className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <section className="bg-white p-6 rounded-lg shadow-md md:col-span-2 lg:col-span-1">
                            <h2 className="text-xl font-semibold mb-4">Project Summary</h2>
                            {projectData ? (
                                <>
                                    <div className="mb-4">
                                        <p className="text-sm font-medium text-gray-500">Total Project Cost (Base)</p>
                                        <p className="text-2xl font-bold text-gray-800">{formatCurrency(projectData.totalCost)}</p>
                                    </div>
                                    <div className="mb-4">
                                        <p className="text-sm font-medium text-gray-500">Total Payments Made</p>
                                        <p className="text-2xl font-bold text-green-600">{formatCurrency(totalPayments)}</p>
                                    </div>
                                    <div className="mb-4">
                                        <p className="text-sm font-medium text-gray-500">Total Project Overrun</p>
                                        <p className="text-xl font-bold text-red-600">{formatCurrency(totalOverrun)}</p>
                                    </div>
                                    <div className="mb-4">
                                        <p className="text-sm font-medium text-gray-500">Projected Final Cost</p>
                                        <p className="text-xl font-bold text-gray-800">{formatCurrency(finalProjectedCost)}</p>
                                    </div>
                                     <div className="mt-6">
                                        <p className="text-sm text-gray-500 mb-2">Completion Progress (based on payments)</p>
                                        <div className="w-full bg-gray-200 rounded-full h-2.5">
                                            <div 
                                                className="bg-blue-500 h-2.5 rounded-full" 
                                                style={{ width: `${Math.min(100, currentProgress)}%` }}
                                            ></div>
                                        </div>
                                    </div>
                                </>
                            ) : (
                                <p className="text-center text-gray-500">Loading project data...</p>
                            )}
                        </section>

                        <section className="bg-white p-6 rounded-lg shadow-md lg:col-span-1">
                            <div className="flex justify-between items-center mb-4">
                                <h2 className="text-xl font-semibold">Project Stages</h2>
                                <button
                                    onClick={handleResetStages}
                                    className="text-sm text-blue-500 hover:text-blue-700 transition-colors focus:outline-none"
                                    aria-label="Reset all project stages"
                                >
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6">
                                      <path strokeLinecap="round" strokeLinejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.055 7.149a8.25 8.25 0 0113.803-3.7l3.181 3.182m-4.991 4.991v-.001m0 0h4.991" />
                                    </svg>
                                </button>
                            </div>
                            <ul className="space-y-3">
                                {projectData && Object.keys(projectData.stages).map((stage, index) => (
                                    <li key={index} className="flex items-center">
                                        <input
                                            type="checkbox"
                                            checked={projectData.stages[stage]}
                                            onChange={() => handleStageChange(stage)}
                                            className="form-checkbox h-5 w-5 text-blue-600 rounded-md border-gray-300"
                                        />
                                        <span className={`ml-3 text-lg font-medium ${projectData.stages[stage] ? 'line-through text-gray-500' : 'text-gray-800'}`}>
                                            {stage}
                                        </span>
                                    </li>
                                ))}
                            </ul>
                            <div className="mt-6 pt-4 border-t border-gray-200">
                                <p className="text-sm font-medium text-gray-500">Total Payments Recorded</p>
                                <p className="text-2xl font-bold text-green-600">{formatCurrency(totalPayments)}</p>
                            </div>
                        </section>
                        
                        <section className="bg-white p-6 rounded-lg shadow-md lg:col-span-1">
                            <h2 className="text-xl font-semibold mb-4">Timeline View</h2>
                            {renderTimeline()}
                        </section>

                        <section className="bg-white p-6 rounded-lg shadow-md col-span-1 md:col-span-3">
                            <h2 className="text-xl font-semibold mb-4 flex justify-between items-center">
                                Provisional Sums
                                <span className="text-base font-normal text-gray-500">Total: {formatCurrency(totalProvisionalSums)}</span>
                            </h2>
                            <div className="bg-gray-50 p-4 rounded-md overflow-y-auto border border-gray-200">
                                <ul className="space-y-3">
                                    {provisionalSums.length > 0 ? provisionalSums.map((item, index) => (
                                        <li key={index} className="flex items-center space-x-2">
                                            <input
                                                type="checkbox"
                                                checked={item.checked}
                                                onChange={() => handleProvisionalSumChange(index)}
                                                className="form-checkbox h-5 w-5 text-blue-600 rounded-md border-gray-300"
                                            />
                                            <span className={`text-lg font-medium ${item.checked ? 'line-through text-gray-500' : 'text-gray-800'}`}>
                                                {item.description} - Estimated: {formatCurrency(item.estimated)}
                                            </span>
                                        </li>
                                    )) : (
                                        <p className="text-sm text-gray-400 text-center">No provisional sums found in the contract.</p>
                                    )}
                                </ul>
                            </div>
                        </section>
                        
                        <section className="bg-white p-6 rounded-lg shadow-md col-span-1 md:col-span-3">
                            <h2 className="text-xl font-semibold mb-4 flex justify-between items-center">
                                Prime Cost Items
                                <span className="text-base font-normal text-gray-500">Total: {formatCurrency(totalPrimeCosts)}</span>
                            </h2>
                            <div className="bg-gray-50 p-4 rounded-md overflow-y-auto border border-gray-200">
                                <ul className="space-y-3">
                                    {primeCosts.length > 0 ? primeCosts.map((item, index) => (
                                        <li key={index} className="flex items-center space-x-2">
                                             <input
                                                type="checkbox"
                                                checked={item.checked}
                                                onChange={() => handlePrimeCostChange(index)}
                                                className="form-checkbox h-5 w-5 text-blue-600 rounded-md border-gray-300"
                                            />
                                            <span className={`text-lg font-medium ${item.checked ? 'line-through text-gray-500' : 'text-gray-800'}`}>
                                                {item.description} - Allowance: {formatCurrency(item.allowance)}
                                            </span>
                                        </li>
                                    )) : (
                                        <p className="text-sm text-gray-400 text-center">No prime cost items found in the contract.</p>
                                    )}
                                </ul>
                            </div>
                        </section>

                        <section className="bg-white p-6 rounded-lg shadow-md col-span-1 md:col-span-2">
                            <h2 className="text-xl font-semibold mb-4">Additional Costs (Overrun)</h2>
                            <form onSubmit={handleAddUnexpectedCost} className="flex flex-col space-y-4 mb-4 items-end">
                                <div className="w-full">
                                    <label className="block text-sm font-medium text-gray-700">Cost (AUD)</label>
                                    <input
                                        type="number"
                                        value={unexpectedCostAmount}
                                        onChange={(e) => setUnexpectedCostAmount(e.target.value)}
                                        placeholder="e.g., 150"
                                        className="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        required
                                    />
                                </div>
                                <div className="w-full">
                                    <label className="block text-sm font-medium text-gray-700">Notes / Description</label>
                                    <textarea
                                        value={unexpectedCostNotes}
                                        onChange={(e) => setUnexpectedCostNotes(e.target.value)}
                                        placeholder="e.g., Extra concrete for retaining wall footing"
                                        className="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        rows="2"
                                    />
                                </div>
                                 <button
                                    type="submit"
                                    className="bg-red-500 text-white p-2 md:mt-5 rounded-md font-semibold hover:bg-red-600 transition-colors w-full md:w-auto"
                                >
                                    Add Cost
                                </button>
                            </form>
                             <div className="bg-gray-50 p-4 rounded-md h-40 overflow-y-auto border border-gray-200">
                                <ul className="space-y-3">
                                    {projectData?.unexpectedCosts?.length > 0 ? projectData.unexpectedCosts.map((cost, index) => (
                                        <li key={index} className="border-b border-gray-200 pb-2 last:border-b-0">
                                            <p className="text-sm font-bold">Cost: {formatCurrency(cost.amount)}</p>
                                            <p className="text-xs text-gray-500">Date: {new Date(cost.date).toLocaleDateString()}</p>
                                            <p className="text-sm text-gray-700 mt-1">{cost.notes}</p>
                                        </li>
                                    )) : (
                                        <p className="text-sm text-gray-400 text-center mt-8">No additional costs added yet.</p>
                                    )}
                                </ul>
                            </div>
                        </section>

                        <section className="bg-white p-6 rounded-lg shadow-md col-span-1 md:col-span-2">
                            <h2 className="text-xl font-semibold mb-4">Payment Tracker</h2>
                            <form onSubmit={handleAddPayment} className="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-2 mb-4 items-end">
                                <div className="flex-1 w-full">
                                    <label className="block text-sm font-medium text-gray-700">Amount (AUD)</label>
                                    <input
                                        type="number"
                                        value={paymentAmount}
                                        onChange={(e) => setPaymentAmount(e.target.value)}
                                        placeholder="e.g., 5000"
                                        className="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        required
                                    />
                                </div>
                                <div className="flex-1 w-full">
                                    <label className="block text-sm font-medium text-gray-700">Date</label>
                                    <input
                                        type="date"
                                        value={paymentDate}
                                        onChange={(e) => setPaymentDate(e.target.value)}
                                        className="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        required
                                    />
                                </div>
                                <button
                                    type="submit"
                                    className="bg-blue-500 text-white p-2 md:mt-5 rounded-md font-semibold hover:bg-blue-600 transition-colors w-full md:w-auto"
                                >
                                    Add Payment
                                </button>
                            </form>
                            <div className="bg-gray-50 p-4 rounded-md h-40 overflow-y-auto border border-gray-200">
                                <ul className="space-y-3">
                                    {payments.length > 0 ? payments.map((payment, index) => (
                                        <li key={index} className="border-b border-gray-200 pb-2 last:border-b-0">
                                            <p className="text-sm">Paid {formatCurrency(payment.amount)} on {new Date(payment.date).toLocaleDateString()}</p>
                                        </li>
                                    )) : (
                                        <p className="text-sm text-gray-400 text-center mt-8">No payments recorded yet.</p>
                                    )}
                                </ul>
                            </div>
                        </section>

                        <section className="bg-white p-6 rounded-lg shadow-md col-span-1 md:col-span-2">
                            <h2 className="text-xl font-semibold mb-4">Notes</h2>
                            <form onSubmit={handleAddNote} className="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-2 mb-4">
                                <input
                                    type="text"
                                    value={noteInput}
                                    onChange={(e) => setNoteInput(e.target.value)}
                                    placeholder="Add a new note..."
                                    className="flex-grow p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                />
                                <button
                                    type="submit"
                                    className="bg-blue-500 text-white p-2 rounded-md font-semibold hover:bg-blue-600 transition-colors"
                                >
                                    Add Note
                                </button>
                            </form>
                            <div className="bg-gray-50 p-4 rounded-md h-64 overflow-y-auto border border-gray-200">
                                <ul className="space-y-3">
                                    {notes.length > 0 ? notes.map((note, index) => (
                                        <li key={index} className="border-b border-gray-200 pb-2 last:border-b-0">
                                            <p className="text-sm">{note.text}</p>
                                            <p className="text-xs text-gray-400 mt-1">
                                                {new Date(note.timestamp).toLocaleDateString()}
                                            </p>
                                        </li>
                                    )) : (
                                        <p className="text-sm text-gray-400 text-center mt-8">No notes yet. Add one to get started!</p>
                                    )}
                                </ul>
                            </div>
                        </section>

                        <section className="bg-white p-6 rounded-lg shadow-md col-span-1 md:col-span-2">
                            <h2 className="text-xl font-semibold mb-4">Items Not Included</h2>
                            <form onSubmit={handleAddExcludedItem} className="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-2 mb-4">
                                <input
                                    type="text"
                                    value={newExcludedItem}
                                    onChange={(e) => setNewExcludedItem(e.target.value)}
                                    placeholder="Add item not included..."
                                    className="flex-grow p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                />
                                <button
                                    type="submit"
                                    className="bg-blue-500 text-white p-2 rounded-md font-semibold hover:bg-blue-600 transition-colors"
                                >
                                    Add
                                </button>
                            </form>
                            <div className="bg-gray-50 p-4 rounded-md h-40 overflow-y-auto border border-gray-200">
                                <ul className="space-y-3">
                                    {excludedItems.length > 0 ? excludedItems.map((item, index) => (
                                        <li key={index} className="flex items-center space-x-2">
                                            <input
                                                type="checkbox"
                                                checked={item.checked}
                                                onChange={() => handleExcludedItemChange(index)}
                                                className="form-checkbox h-5 w-5 text-blue-600 rounded-md border-gray-300"
                                            />
                                            <span className={`text-lg font-medium ${item.checked ? 'line-through text-gray-500' : 'text-gray-800'}`}>
                                                {item.description}
                                            </span>
                                        </li>
                                    )) : (
                                        <p className="text-sm text-gray-400 text-center mt-8">No excluded items added yet.</p>
                                    )}
                                </ul>
                            </div>
                        </section>
                    </main>
                </div>
            );
        };

        // Render the App component to the root element
        ReactDOM.createRoot(document.getElementById('root')).render(
          <React.StrictMode>
            <App />
          </React.StrictMode>
        );
    </script>
</body>
</html>
